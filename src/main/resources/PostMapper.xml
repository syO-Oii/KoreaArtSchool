<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.maximum.koreaartschool.dao.PostMapper"> <!--PostDao 인터페이스와 관련된 mapper-->

    <resultMap id="postInfoResultMap" type="com.maximum.koreaartschool.dto.PostDto">
        <id property="postNumber" column="PST_NO"/>
        <result property="bbsId" column="BBS_ID"/>
        <result property="postTitle" column="PST_TTL"/>
        <result property="postContent" column="PST_CN"/>
        <result property="writer" column="WRTR"/>
        <result property="writeDate" column="WRT_DT"/>
        <result property="fileNumber" column="FILE_NO"/>
        <result property="deleteYn" column="DEL_YN"/>
        <result property="adminEmail" column="ADMIN_EML"/>
    </resultMap>

    <!-- PostDao에 정의된 select메서드(공지사항 리스트 보기) -->    <!-- resultType : 리턴 타입 -->
    <select id="listDao" resultType="com.maximum.koreaartschool.dto.PostDto">
        SELECT PST_NO AS postNumber,
               WRTR AS writer,
               PST_TTL AS postTitle,
               PST_CN AS postContent,
               WRT_DT AS writeDate,
               FILE_NM AS fileNm,
               DEL_YN AS delYn,
               ADMIN_EML AS adminEml
        FROM POST_INFO
        WHERE BBS_ID = 1
        ORDER BY PST_NO ASC
    </select>


    <!-- PostDao에 정의된 select메서드(개별 뷰 보기) -->    <!-- resultType : 리턴 타입 -->
    <select id="viewDao" resultType="com.maximum.koreaartschool.dto.PostDto">
        SELECT PST_NO AS postNumber,
               WRTR AS writer,
               PST_TTL AS postTitle,
               PST_CN AS postContent,
               WRT_DT AS writeDate,
               FILE_NM AS fileNm,
               FILE_PATH AS filePath,
               DEL_YN AS delYn,
               ADMIN_EML AS adminEml
        FROM POST_INFO
        WHERE PST_NO = #{postNumber}
    </select>

    <!-- PostDao에 정의된 insert메서드(글 작성) -->
    <insert id="postInsertDao">
        INSERT INTO POST_INFO(BBS_ID, PST_TTL, PST_CN, WRTR, WRT_DT, FILE_NM, FILE_PATH, DEL_YN, ADMIN_EML)
        VALUES (#{bbsId}, #{postTitle}, #{postContent}, #{writer}, DEFAULT, #{fileName}, NULL, 'N', #{adminEml})
    </insert>

    <!-- PostDao에 정의된 update메서드(글 수정) -->
    <update id="postUpdateDao">
        UPDATE POST_INFO
        SET PST_TTL = #{postTitle},
            PST_CN = #{postContent}
        WHERE PST_NO = #{postNumber}
    </update>

    <!-- PostDao에 정의된 delete메서드(글 삭제) -->
    <delete id="postDeleteDao">
        DELETE FROM POST_INFO
        WHERE PST_NO = #{postNumber}
    </delete>

    <!-- 단일 게시물 정보를 가져오는 쿼리 -->
    <select id="getPostByNo" parameterType="java.lang.Integer" resultType="com.maximum.koreaartschool.dto.PostDto">
        SELECT PST_NO AS postNumber, WRTR AS writer, PST_TTL AS postTitle, PST_CN AS postContent, WRT_DT AS writeDate, FILE_NM AS fileNm
        FROM POST_INFO
        WHERE PST_NO = #{postNumber}
    </select>

</mapper>